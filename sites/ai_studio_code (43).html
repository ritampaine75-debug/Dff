<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Finger Drawing App</title>
    <!-- Import MediaPipe Libraries via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js" crossorigin="anonymous"></script>
    <style>
        body { margin: 0; padding: 0; background: #111; color: white; font-family: sans-serif; overflow: hidden; }
        #container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        /* Mirror the video and canvas so it feels like a mirror */
        video, #canvas { 
            position: absolute; 
            width: 100%; height: 100%; 
            object-fit: cover; 
            transform: scaleX(-1); 
        }

        #canvas { z-index: 10; pointer-events: none; }
        video { z-index: 1; opacity: 0.3; } /* Low opacity so you see the drawing better */

        .ui {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 100; text-align: center; width: 90%;
        }
        button {
            padding: 10px 20px; font-size: 16px; border-radius: 20px;
            border: none; background: #ff4757; color: white; cursor: pointer;
        }
        .status { font-size: 12px; margin-bottom: 10px; color: #00ff00; }
    </style>
</head>
<body>

<div id="container">
    <div class="ui">
        <div id="status" class="status">Loading AI Model...</div>
        <button onclick="clearCanvas()">Clear Canvas</button>
    </div>
    
    <video id="webcam" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
</div>

<script type="module">
    import { HandLandmarker, FilesetResolver } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0";

    const video = document.getElementById("webcam");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const statusDiv = document.getElementById("status");

    let handLandmarker = undefined;
    let lastVideoTime = -1;
    let lastPoint = null;

    // --- SETTINGS ---
    const DRAW_COLOR = "#00D2FF"; // Your one supported color
    const LINE_WIDTH = 8;

    async function init() {
        const vision = await FilesetResolver.forVisionTasks(
            "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"
        );
        
        handLandmarker = await HandLandmarker.createFromOptions(vision, {
            baseOptions: {
                modelAssetPath: `https://storage.googleapis.com/mediapipe-tasks/hand_landmarker/hand_landmarker.task`,
                delegate: "GPU"
            },
            runningMode: "VIDEO",
            numHands: 1
        });

        statusDiv.innerText = "Model Ready! Point your index finger to draw.";
        startCamera();
    }

    function startCamera() {
        navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: "user", width: 1280, height: 720 } 
        }).then((stream) => {
            video.srcObject = stream;
            video.addEventListener("loadeddata", predictWebcam);
        });
    }

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    async function predictWebcam() {
        let startTimeMs = performance.now();
        
        if (lastVideoTime !== video.currentTime) {
            lastVideoTime = video.currentTime;
            const results = handLandmarker.detectForVideo(video, startTimeMs);

            if (results.landmarks && results.landmarks.length > 0) {
                // Landmark 8 is the INDEX_FINGER_TIP
                const indexFinger = results.landmarks[0][8];
                
                // Convert normalized (0-1) coordinates to pixel coordinates
                const x = indexFinger.x * canvas.width;
                const y = indexFinger.y * canvas.height;

                drawOnCanvas(x, y);
            } else {
                // If no hand detected, break the line
                lastPoint = null;
            }
        }
        window.requestAnimationFrame(predictWebcam);
    }

    function drawOnCanvas(x, y) {
        ctx.strokeStyle = DRAW_COLOR;
        ctx.lineWidth = LINE_WIDTH;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        if (lastPoint) {
            ctx.beginPath();
            ctx.moveTo(lastPoint.x, lastPoint.y);
            ctx.lineTo(x, y);
            ctx.stroke();
        }
        
        lastPoint = { x, y };
    }

    window.clearCanvas = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    init();
</script>

</body>
</html>