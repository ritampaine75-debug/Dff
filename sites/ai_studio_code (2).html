<!DOCTYPE html>
<html lang="en">
<head>
<script>(function(s){s.dataset.zone='10461270',s.src='https://gizokraijaw.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
<script>(function(s){s.dataset.zone='10461234',s.src='https://nap5k.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Breath & Wellness Challenge</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Manrope:wght@400;600;800&family=Montserrat:wght@400;600;700&family=Nunito:wght@400;600;800&family=Outfit:wght@400;500;700&family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ----------------------------------
           CSS VARIABLES & THEMES
        ---------------------------------- */
        :root {
            /* Default: Calm Medical Green */
            --primary: #00BFA5;
            --primary-dark: #008E76;
            --bg-color: #F0F4F4;
            --card-bg: #FFFFFF;
            --text-main: #2D3436;
            --text-sub: #636E72;
            --accent: #E0F2F1;
            --font-head: 'Poppins', sans-serif;
            --font-body: 'Inter', sans-serif;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --gradient: none;
            --nav-bg: #FFFFFF;
            --nav-active: #00BFA5;
            --nav-inactive: #B2BEC3;
        }

        /* Theme 2: Modern Blue Wellness */
        body.theme-blue {
            --primary: #2980B9;
            --primary-dark: #1A5276;
            --bg-color: #ECF0F1;
            --card-bg: #FFFFFF;
            --text-main: #2C3E50;
            --text-sub: #7F8C8D;
            --accent: #D6EAF8;
            --font-head: 'Outfit', sans-serif;
            --font-body: 'Roboto', sans-serif;
            --nav-active: #2980B9;
        }

        /* Theme 3: Gradient Wellness Premium */
        body.theme-gradient {
            --primary: #6C5CE7;
            --primary-dark: #4834D4;
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-main: #2D3436;
            --text-sub: #636E72;
            --accent: #EAE6FF;
            --font-head: 'Montserrat', sans-serif;
            --font-body: 'Inter', sans-serif;
            --gradient: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            --nav-active: #6C5CE7;
        }

        /* Theme 4: Dark Calm Focus */
        body.theme-dark {
            --primary: #00b894;
            --primary-dark: #008f72;
            --bg-color: #1e272e;
            --card-bg: #2d3436;
            --text-main: #dfe6e9;
            --text-sub: #b2bec3;
            --accent: #2d3436;
            --font-head: 'Manrope', sans-serif;
            --font-body: 'Inter', sans-serif;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            --nav-bg: #2d3436;
            --nav-active: #00b894;
            --nav-inactive: #636e72;
        }

        /* Theme 5: Minimal Soft Pastel */
        body.theme-pastel {
            --primary: #81ecec;
            --primary-dark: #4BCFFA;
            --bg-color: #f7f1e3;
            --card-bg: #ffffff;
            --text-main: #40407a;
            --text-sub: #84817a;
            --accent: #dff9fb;
            --font-head: 'Nunito', sans-serif;
            --font-body: 'Nunito', sans-serif;
            --nav-active: #00cec9;
        }

        /* ----------------------------------
           RESET & CORE STYLES
        ---------------------------------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        h1, h2, h3, h4 {
            font-family: var(--font-head);
            font-weight: 600;
        }

        button {
            border: none;
            outline: none;
            cursor: pointer;
            font-family: var(--font-head);
        }

        /* ----------------------------------
           LAYOUT CONTAINERS
        ---------------------------------- */
        .app-header {
            padding: 20px;
            background: var(--card-bg);
            box-shadow: var(--shadow);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 90px; /* Space for bottom nav */
            position: relative;
        }

        .view-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ----------------------------------
           BOTTOM NAVIGATION
        ---------------------------------- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background: var(--nav-bg);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--nav-inactive);
            font-size: 0.8rem;
            gap: 5px;
            transition: all 0.3s;
            padding: 10px;
        }

        .nav-item i {
            font-size: 1.4rem;
        }

        .nav-item.active {
            color: var(--nav-active);
            transform: translateY(-2px);
        }

        /* ----------------------------------
           COMPONENTS: CARDS & BUTTONS
        ---------------------------------- */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            width: 100%;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: background 0.3s;
        }

        .theme-gradient .btn-primary {
            background: var(--gradient);
        }

        .btn-primary:active {
            background: var(--primary-dark);
            transform: scale(0.98);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
        }

        /* ----------------------------------
           SPECIFIC FEATURES
        ---------------------------------- */
        
        /* 1. Timer Circle */
        .timer-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 30px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }

        .timer-text {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--primary);
            font-family: var(--font-head);
        }

        /* 2. Breathing Animation */
        .breathe-circle {
            width: 150px;
            height: 150px;
            background: var(--primary);
            border-radius: 50%;
            margin: 50px auto;
            opacity: 0.8;
            box-shadow: 0 0 0 0 rgba(0, 191, 165, 0.4);
        }

        .breathe-circle.animating {
            animation: breatheAnim 12s infinite ease-in-out;
        }

        @keyframes breatheAnim {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--primary), 0.4); } /* Start Inhale */
            35% { transform: scale(1.8); box-shadow: 0 0 50px 20px rgba(255,255,255, 0.2); } /* End Inhale */
            65% { transform: scale(1.8); } /* Hold */
            100% { transform: scale(1); } /* Exhale */
        }

        .instruction-text {
            text-align: center;
            font-size: 1.5rem;
            margin-top: 20px;
            color: var(--primary);
            font-weight: bold;
            min-height: 40px;
        }

        /* 3. Stats & Streak */
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-box {
            background: var(--accent);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-sub);
        }

        /* 4. Tips List */
        .tip-item {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        /* ----------------------------------
           MODALS
        ---------------------------------- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .disclaimer-text {
            font-size: 0.9rem;
            color: var(--text-sub);
            line-height: 1.6;
            margin: 15px 0;
            text-align: left;
            background: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
        }

        .cipla-logo-text {
            font-weight: bold;
            color: #2980b9; 
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .modal-result-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* Theme Selector */
        .theme-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .theme-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-radius: 10px;
            background: var(--bg-color);
            border: 2px solid transparent;
        }

        .theme-btn.active-theme {
            border-color: var(--primary);
        }

        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

    </style>
</head>
<body class="theme-medical"> <!-- Default Class -->

    <!-- =========================
         DISCLAIMER MODAL (MANDATORY)
         ========================= -->
    <div id="disclaimerModal" class="modal-overlay" style="display: flex;">
        <div class="modal-content">
            <div class="cipla-logo-text">Cipla Limited</div>
            <h3>Health Awareness</h3>
            <div class="disclaimer-text">
                <strong>Disclaimer:</strong> Brought to you by Cipla Limited for information and awareness purposes.<br><br>
                <strong>NOT INTENDED AS A SUBSTITUTE FOR PROFESSIONAL MEDICAL ADVICE.</strong><br><br>
                Please consult your doctor or a healthcare professional before starting any treatment or medicine.
            </div>
            <button class="btn-primary" onclick="acceptDisclaimer()">I Understand</button>
        </div>
    </div>

    <!-- =========================
         TEST WARNING MODAL
         ========================= -->
    <div id="testWarningModal" class="modal-overlay">
        <div class="modal-content">
            <i class="fa-solid fa-triangle-exclamation modal-result-icon" style="color: orange; font-size: 3rem;"></i>
            <h3>Safety First</h3>
            <p style="color: var(--text-sub); margin: 15px 0;">
                If you feel dizzy, uncomfortable, or short of breath, <strong>STOP IMMEDIATELY</strong>. This is not a competition.
            </p>
            <div class="disclaimer-text" style="font-size: 0.75rem;">
                Disclaimer: Brought to you by Cipla Limited for information purposes. Not medical advice.
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-outline" onclick="closeModal('testWarningModal')" style="flex:1">Cancel</button>
                <button class="btn-primary" onclick="proceedToTest()" style="flex:1">Start</button>
            </div>
        </div>
    </div>

    <!-- =========================
         RESULT MODAL
         ========================= -->
    <div id="resultModal" class="modal-overlay">
        <div class="modal-content">
            <i class="fa-solid fa-lungs modal-result-icon"></i>
            <h2 id="resultTitle">Great Job!</h2>
            <h1 id="resultTime" style="font-size: 3rem; color: var(--primary); margin: 10px 0;">00s</h1>
            <p id="resultCategory" style="font-weight: bold; color: var(--text-sub);">Average</p>
            <p id="resultMessage" style="font-size: 0.9rem; margin: 15px 0; color: var(--text-sub);">
                Lung health is vital. Keep practicing!
            </p>
            
            <div style="display:grid; gap: 10px;">
                <button class="btn-primary" onclick="shareResult()">
                    <i class="fa-brands fa-whatsapp"></i> Share w/ Friends
                </button>
                <button class="btn-outline" onclick="closeModal('resultModal')">Close</button>
            </div>
            <div style="margin-top: 15px; font-size: 0.7rem; opacity: 0.7;">
                Information only. Not a medical diagnosis.
            </div>
        </div>
    </div>

    <!-- =========================
         APP HEADER
         ========================= -->
    <header class="app-header">
        <div class="logo-area">
            <i class="fa-solid fa-heart-pulse logo-icon"></i>
            <div>
                <h4 style="line-height: 1;">Breath &</h4>
                <span style="font-size: 0.8rem; color: var(--text-sub);">Wellness Challenge</span>
            </div>
        </div>
        <div id="streakDisplay" style="text-align: right;">
            <i class="fa-solid fa-fire" style="color: orange;"></i> <span id="streakCount">0</span> Days
        </div>
    </header>

    <!-- =========================
         MAIN CONTENT AREA
         ========================= -->
    <main class="main-content">
        
        <!-- VIEW: HOME -->
        <section id="view-home" class="view-section active">
            <div class="card" style="background: var(--primary); color: white;">
                <h2>Welcome Back!</h2>
                <p style="opacity: 0.9; margin-top: 5px;">Take a moment to check your lung capacity today.</p>
            </div>

            <h3>Quick Start</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                <div class="card" onclick="navTo('view-challenge')" style="margin:0; text-align: center; cursor: pointer;">
                    <i class="fa-solid fa-stopwatch" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                    <h4>Test Now</h4>
                </div>
                <div class="card" onclick="navTo('view-calm')" style="margin:0; text-align: center; cursor: pointer;">
                    <i class="fa-solid fa-wind" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                    <h4>Relax</h4>
                </div>
            </div>

            <h3 style="margin-top: 25px;">Daily Tip</h3>
            <div class="card" style="margin-top: 10px;">
                <div style="display: flex; gap: 15px;">
                    <i class="fa-solid fa-lightbulb" style="color: #f1c40f; font-size: 1.5rem;"></i>
                    <p id="dailyTipText" style="font-size: 0.9rem; color: var(--text-sub);">
                        Deep breathing exercises can help increase lung capacity and reduce stress levels.
                    </p>
                </div>
            </div>
        </section>

        <!-- VIEW: CHALLENGE (BREATH TEST) -->
        <section id="view-challenge" class="view-section">
            <h2 style="text-align: center;">Breath Holding Test</h2>
            <p style="text-align: center; color: var(--text-sub); font-size: 0.9rem; margin-bottom: 20px;">
                Take a deep breath, tap Start, and hold.
            </p>

            <div class="timer-container">
                <div id="timerDisplay" class="timer-text">00.0</div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button id="btnStartTest" class="btn-primary" onclick="initiateTest()">
                    <i class="fa-solid fa-play"></i> Start
                </button>
                <button id="btnStopTest" class="btn-primary" style="background: #e74c3c; display: none;" onclick="stopTest()">
                    <i class="fa-solid fa-stop"></i> STOP
                </button>
            </div>

            <!-- Fun Levels -->
            <h3 style="margin-top: 40px;">Fun Levels</h3>
            <div class="card" style="margin-top: 10px; padding: 15px;">
                <div style="margin-bottom: 10px;">
                    <span style="font-weight: bold;">Level 1:</span> Beginner (15s)
                    <div style="background: #eee; height: 8px; border-radius: 4px; margin-top: 5px;">
                        <div id="lvl1" style="width: 0%; height: 100%; background: var(--primary); border-radius: 4px; transition: width 1s;"></div>
                    </div>
                </div>
                <div>
                    <span style="font-weight: bold;">Level 2:</span> Pro (40s)
                    <div style="background: #eee; height: 8px; border-radius: 4px; margin-top: 5px;">
                        <div id="lvl2" style="width: 0%; height: 100%; background: var(--primary); border-radius: 4px; transition: width 1s;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: CALM (GUIDED BREATHING) -->
        <section id="view-calm" class="view-section">
            <h2 style="text-align: center;">Guided Relaxation</h2>
            <p style="text-align: center; color: var(--text-sub);">Follow the circle rhythm.</p>
            
            <div id="breatheCircle" class="breathe-circle"></div>
            
            <div id="breatheInstruction" class="instruction-text">Tap Start</div>
            
            <button id="btnCalmToggle" class="btn-primary" style="margin-top: 30px;" onclick="toggleCalmBreathing()">
                Start Session
            </button>
        </section>

        <!-- VIEW: PROGRESS/STATS -->
        <section id="view-stats" class="view-section">
            <h2>Your Progress</h2>
            <div class="stat-grid" style="margin-top: 20px;">
                <div class="stat-box">
                    <div class="stat-value" id="statBestTime">0s</div>
                    <div class="stat-label">Best Time</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statTotalAttempts">0</div>
                    <div class="stat-label">Total Attempts</div>
                </div>
            </div>

            <h3 style="margin-top: 30px;">Lung Health Awareness</h3>
            <div style="margin-top: 15px;">
                <div class="tip-item">
                    <i class="fa-solid fa-smoking" style="color: #e74c3c; margin-top: 3px;"></i>
                    <div>
                        <strong>Avoid Toxins</strong>
                        <p style="font-size: 0.85rem; color: var(--text-sub);">Exposure to smoke, dust, and chemicals can damage lungs over time.</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fa-solid fa-person-running" style="color: var(--primary); margin-top: 3px;"></i>
                    <div>
                        <strong>Stay Active</strong>
                        <p style="font-size: 0.85rem; color: var(--text-sub);">Regular cardio helps improve lung efficiency and capacity.</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fa-solid fa-droplet" style="color: #3498db; margin-top: 3px;"></i>
                    <div>
                        <strong>Hydration</strong>
                        <p style="font-size: 0.85rem; color: var(--text-sub);">Drinking water helps thin the mucus lining the airways.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: SETTINGS -->
        <section id="view-settings" class="view-section">
            <h2>Settings & Themes</h2>
            
            <div class="card" style="margin-top: 20px;">
                <h4>Choose Theme</h4>
                <div class="theme-grid" style="margin-top: 15px;">
                    <div class="theme-btn" onclick="setTheme('theme-medical')">
                        <span>Calm Medical Green</span>
                        <div class="color-dot" style="background: #00BFA5;"></div>
                    </div>
                    <div class="theme-btn" onclick="setTheme('theme-blue')">
                        <span>Modern Blue Wellness</span>
                        <div class="color-dot" style="background: #2980B9;"></div>
                    </div>
                    <div class="theme-btn" onclick="setTheme('theme-gradient')">
                        <span>Gradient Premium</span>
                        <div class="color-dot" style="background: linear-gradient(135deg, #74b9ff, #a29bfe);"></div>
                    </div>
                    <div class="theme-btn" onclick="setTheme('theme-dark')">
                        <span>Dark Calm Focus</span>
                        <div class="color-dot" style="background: #2d3436; border: 1px solid #fff;"></div>
                    </div>
                    <div class="theme-btn" onclick="setTheme('theme-pastel')">
                        <span>Minimal Soft Pastel</span>
                        <div class="color-dot" style="background: #81ecec;"></div>
                    </div>
                </div>
            </div>

            <button class="btn-outline" style="width: 100%; margin-top: 10px;" onclick="resetData()">
                <i class="fa-solid fa-trash"></i> Reset Progress Data
            </button>

            <div style="text-align: center; margin-top: 30px; opacity: 0.6; font-size: 0.8rem;">
                App Version 1.0.0<br>
                Awareness Initiative
            </div>
        </section>

    </main>

    <!-- =========================
         BOTTOM NAVIGATION
         ========================= -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navTo('view-home')" id="nav-home">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" onclick="navTo('view-challenge')" id="nav-challenge">
            <i class="fa-solid fa-stopwatch"></i>
            <span>Test</span>
        </div>
        <div class="nav-item" onclick="navTo('view-calm')" id="nav-calm">
            <i class="fa-solid fa-spa"></i>
            <span>Calm</span>
        </div>
        <div class="nav-item" onclick="navTo('view-stats')" id="nav-stats">
            <i class="fa-solid fa-chart-simple"></i>
            <span>Progress</span>
        </div>
        <div class="nav-item" onclick="navTo('view-settings')" id="nav-settings">
            <i class="fa-solid fa-gear"></i>
            <span>Settings</span>
        </div>
    </nav>

    <!-- =========================
         JAVASCRIPT LOGIC
         ========================= -->
    <script>
        /* --- STATE & DATA --- */
        const APP_STORAGE_KEY = 'breath_wellness_v1';
        let appData = {
            theme: 'theme-medical',
            bestTime: 0,
            totalAttempts: 0,
            streak: 0,
            lastVisit: null
        };
        let timerInterval;
        let startTime;
        let isBreathingActive = false;
        let breathingTimeout;

        /* --- INITIALIZATION --- */
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            applyTheme(appData.theme);
            checkStreak();
            updateUI();
            
            // Random Tip on Home
            const tips = [
                "Diaphragmatic breathing strengthens the diaphragm.",
                "Pursed lip breathing slows down your breathing rate.",
                "Stay hydrated to keep mucosal linings thin.",
                "Good posture allows lungs to expand fully.",
                "Indoor plants can help improve air quality."
            ];
            document.getElementById('dailyTipText').innerText = tips[Math.floor(Math.random() * tips.length)];
        });

        /* --- NAVIGATION --- */
        function navTo(viewId) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            // Show target
            document.getElementById(viewId).classList.add('active');
            
            // Update Bottom Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const navMap = {
                'view-home': 'nav-home',
                'view-challenge': 'nav-challenge',
                'view-calm': 'nav-calm',
                'view-stats': 'nav-stats',
                'view-settings': 'nav-settings'
            };
            document.getElementById(navMap[viewId]).classList.add('active');

            // Specific View Logic
            if(viewId !== 'view-challenge') resetTimerUI();
            if(viewId !== 'view-calm') stopCalmBreathing();
        }

        /* --- DISCLAIMER --- */
        function acceptDisclaimer() {
            document.getElementById('disclaimerModal').style.display = 'none';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        /* --- BREATH TEST LOGIC --- */
        function initiateTest() {
            // Show Safety Warning First
            document.getElementById('testWarningModal').style.display = 'flex';
        }

        function proceedToTest() {
            closeModal('testWarningModal');
            startTimer();
        }

        function startTimer() {
            document.getElementById('btnStartTest').style.display = 'none';
            document.getElementById('btnStopTest').style.display = 'inline-block';
            
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                document.getElementById('timerDisplay').innerText = elapsed.toFixed(1);
            }, 100);
        }

        function stopTest() {
            clearInterval(timerInterval);
            const finalTime = parseFloat(document.getElementById('timerDisplay').innerText);
            
            document.getElementById('btnStartTest').style.display = 'inline-block';
            document.getElementById('btnStopTest').style.display = 'none';

            processResult(finalTime);
        }

        function resetTimerUI() {
            clearInterval(timerInterval);
            document.getElementById('timerDisplay').innerText = "00.0";
            document.getElementById('btnStartTest').style.display = 'inline-block';
            document.getElementById('btnStopTest').style.display = 'none';
        }

        function processResult(time) {
            // Update Stats
            appData.totalAttempts++;
            if(time > appData.bestTime) {
                appData.bestTime = time;
            }
            saveData();
            updateUI();

            // Categorize
            let category = "Beginner";
            let msg = "Good start! Practice daily to improve.";
            
            if(time > 15 && time <= 40) {
                category = "Average";
                msg = "Doing well! Your lungs are getting stronger.";
            } else if (time > 40) {
                category = "Advanced";
                msg = "Impressive capacity! Keep maintaining it.";
            }

            // Show Result Modal
            document.getElementById('resultTime').innerText = time.toFixed(1) + "s";
            document.getElementById('resultCategory').innerText = category;
            document.getElementById('resultMessage').innerText = msg;
            document.getElementById('resultModal').style.display = 'flex';
        }

        /* --- LEVELS UI --- */
        function updateLevelsUI() {
            // Visual logic for levels bar
            const best = appData.bestTime;
            // Level 1 cap at 15s
            let lvl1Pct = (best / 15) * 100;
            if(lvl1Pct > 100) lvl1Pct = 100;
            document.getElementById('lvl1').style.width = lvl1Pct + '%';

            // Level 2 cap at 40s
            let lvl2Pct = (best / 40) * 100;
            if(lvl2Pct > 100) lvl2Pct = 100;
            document.getElementById('lvl2').style.width = lvl2Pct + '%';
        }

        /* --- CALM BREATHING --- */
        function toggleCalmBreathing() {
            if(isBreathingActive) {
                stopCalmBreathing();
            } else {
                startCalmBreathing();
            }
        }

        function startCalmBreathing() {
            isBreathingActive = true;
            document.getElementById('btnCalmToggle').innerText = "Stop Session";
            const circle = document.getElementById('breatheCircle');
            const text = document.getElementById('breatheInstruction');
            
            circle.classList.add('animating');
            
            // Guided Text Logic (4-4-4 Rhythm: Inhale 4s, Hold 4s, Exhale 4s = 12s cycle)
            // Matches CSS animation percentages
            
            const runCycle = () => {
                if(!isBreathingActive) return;
                text.innerText = "Inhale...";
                setTimeout(() => {
                    if(!isBreathingActive) return;
                    text.innerText = "Hold...";
                }, 4000); // 35% of 12s is 4.2s roughly, simplified to 4s
                setTimeout(() => {
                    if(!isBreathingActive) return;
                    text.innerText = "Exhale...";
                }, 8000); // 65% is hold end
            };

            runCycle();
            breathingTimeout = setInterval(runCycle, 12000);
        }

        function stopCalmBreathing() {
            isBreathingActive = false;
            document.getElementById('btnCalmToggle').innerText = "Start Session";
            document.getElementById('breatheCircle').classList.remove('animating');
            document.getElementById('breatheInstruction').innerText = "Tap Start";
            clearInterval(breathingTimeout);
        }

        /* --- STORAGE & STREAKS --- */
        function checkStreak() {
            const today = new Date().toDateString();
            
            if(appData.lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if(appData.lastVisit === yesterday.toDateString()) {
                    appData.streak++;
                } else {
                    appData.streak = 1; // Reset or Start new
                }
                appData.lastVisit = today;
                saveData();
            }
        }

        function saveData() {
            localStorage.setItem(APP_STORAGE_KEY, JSON.stringify(appData));
        }

        function loadData() {
            const saved = localStorage.getItem(APP_STORAGE_KEY);
            if(saved) {
                appData = JSON.parse(saved);
            }
        }

        function resetData() {
            if(confirm("Are you sure you want to reset all progress?")) {
                appData.bestTime = 0;
                appData.totalAttempts = 0;
                appData.streak = 1;
                saveData();
                updateUI();
                alert("Data reset.");
            }
        }

        function updateUI() {
            document.getElementById('streakCount').innerText = appData.streak;
            document.getElementById('statBestTime').innerText = appData.bestTime.toFixed(1) + 's';
            document.getElementById('statTotalAttempts').innerText = appData.totalAttempts;
            updateLevelsUI();
        }

        /* --- THEME SYSTEM --- */
        function setTheme(themeName) {
            appData.theme = themeName;
            applyTheme(themeName);
            saveData();
        }

        function applyTheme(themeName) {
            // Remove existing theme classes
            document.body.className = '';
            document.body.classList.add(themeName);

            // Update Active UI in Settings
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active-theme');
                if(btn.onclick.toString().includes(themeName)) {
                    btn.classList.add('active-theme');
                }
            });
        }

        /* --- SHARING --- */
        function shareResult() {
            const text = `I held my breath for ${document.getElementById('resultTime').innerText} on the Breath & Wellness Awareness App! ðŸ«\n\nTake the challenge and check your lung health awareness.\n\nDisclaimer: Educational purpose only, not medical advice.`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Breath Challenge',
                    text: text,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback to Clipboard
                navigator.clipboard.writeText(text).then(() => {
                    alert("Result copied to clipboard!");
                });
            }
        }
    </script>
</body>
</html>